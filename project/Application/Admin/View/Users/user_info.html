
<include file="Public/header" />
<div class="content" style="background-color: #ECF0F5">
    <include file="Public/nav" />
    <div class="row-fluid fl" id="main">
        <div class="tableBox">
            <div class="titleBar">用户管理/<span>用户详情</span></div>
            
            <h1 class="text-center __user">当前用户：</h1>
            <input type="hidden" value='{{$user}}' class="_inp">
            <input type="hidden" value='{{$flow}}' class="_inp">
            <input type="hidden" value='{{$consume}}' class="_inp">
            <div class="_tb _user" style="border-top: 4px #5ED0F4 solid;
    border-bottom:  1px #CCCCCC solid">
                <h3>用户基础信息</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <td>姓名</td>
                            <td>手机</td>
                            <td>安装地址</td>
                            <td>用户余额</td>
                            <td>最后登录时间</td>
                            <td>登录IP</td>
                            <td>注册时间</td>
                            <td>用户状态</td>
                            <td>备注</td>
                        </tr>
                    </thead>
                    <tbody class="_user_"></tbody>
                </table>
            </div>
            
            <div class="_tb _user" style="border-top: 4px #5ED0F4 solid;
    border-bottom:  1px #CCCCCC solid">
                <h3>充值记录</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <td>用户ID</td>
                            <td>充值方式</td>
                            <td>订单号码</td>
                            <td>充值金额/元</td>
                            <td>当前余额</td>
                            <td>充值时间</td>
                        </tr>
                    </thead>
                    <tbody class="_flow"></tbody>
                </table>
                
            </div>

            <div class="_tb _user" style="border-top: 4px #5ED0F4 solid;
    border-bottom:  1px #CCCCCC solid">
                <h3>消费记录</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <td>设备ID</td>
                            <td>用户ID</td>
                            <td>IC卡号</td>
                            <td>用户余额</td>
                            <td>消费地址</td>
                            <td>消费时间</td>
                        </tr>
                    </thead>
                    <tbody class="_consume"></tbody>
                </table>
            </div>
        </div>
        <script>
            var _inp = $('._inp')
            var user = _inp.eq(0).val()
            var flow = _inp.eq(1).val()
            var consume = _inp.eq(2).val()
            var userStatus = {
                '0':'禁用',
                '1':'启用'
            }
            var mode = {
                '0':'系统赠送',
                '1':'微信',
                '2':'支付宝'
            }
            console.log(user,flow,consume)
            user.replace(/({.+})/,function(match,p1,offset,str){
                var data = JSON.parse(match)
                $('.__user').append(data.name)
                var login_time = data.login_time?new Date(Number(data.login_time)*1000).toLocaleString():'--'
                var create_at = create_at?new Date(Number(data.create_at)*1000).toLocaleString():'--'
                var installaddress = data.installaddress?data.installaddress:'--'
                var html = '<tr>'+
                                '<td>'+data.name+'</td>'+
                                '<td>'+data.phone+'</td>'+
                                '<td>'+installaddress+'</td>'+
                                '<td>'+data.balance+'</td>'+
                                '<td>'+login_time+'</td>'+
                                '<td>'+data.login_ip+'</td>'+
                                '<td>'+create_at+'</td>'+
                                '<td>'+userStatus[data.user_status]+'</td>'+
                            '</tr>'
                $('._user_').append(html)
            })
            flow.replace(/(\[.+\])/,function(match,p1,offset,str){
                var data = JSON.parse(match)
                data.forEach(function(el,i,arr){
                    var time = el.time?new Date(Number(el.time)*1000).toLocaleString():'--'
                    var ordernumber = el.ordernumber?el.ordernumber:'--'
                    var currentbalance = el.currentbalance?el.currentbalance:'--'
                    var money = el.money?el.money:'--'
                    var html = '<tr>'+
                                    '<td>'+el.id+'</td>'+
                                    '<td>'+mode[el.mode]+'</td>'+
                                    '<td>'+ordernumber+'</td>'+
                                    '<td>'+money+'</td>'+
                                    '<td>'+currentbalance+'</td>'+
                                    '<td>'+time.trim()+'</td>'+
                                '</tr>'
                    $('._flow').append(html)
                })
            })

            consume.replace(/(\[.+\])/,function(match,p1,offset,str){
                var data = JSON.parse(match)
                data.forEach(function(el,i,arr){
                    var time = el.time?new Date(Number(el.time)*1000).toLocaleString():'--'
                    var icid = el.icid?el.icid:'--'
                    var address = el.address?el.address:'--'
                    var html = '<tr>'+
                                    '<td>'+el.did+'</td>'+
                                    '<td>'+el.id+'</td>'+
                                    '<td>'+icid+'</td>'+
                                    '<td>'+el.flow+'</td>'+
                                    '<td>'+address+'</td>'+
                                    '<td>'+time+'</td>'+
                                '</tr>'
                    $('._consume').append(html)
                })
                
                                
            })
        </script>
        <!-- footer part -->
        <include file="Public/footer" />
    </div>
</div>

