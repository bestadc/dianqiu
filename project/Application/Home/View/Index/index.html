<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1" >
<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/mobileStyle.css">
<title>点球共享水</title>
<style>
   /* #canvas {
        top: 5%;
    }
    .canvasBox .service{
        width: 20vw;
        height: 20vw;
        position: absolute;
        right: 20%;
        top: 38%;
        z-index: 10;
    }
    #waterDetial {
        width: 100%;
        display: none;
        position: absolute;
        bottom: 14%;
        border-top: 1px solid #d8d1d1;
        border-bottom: 1px solid #d8d1d1;
        font-size: 18px;
    }
    #waterDetial>div {
        display: flex;
        padding: 2% 6%;
    }
    #waterDetial>div>span {
        width: 50%;
        display: flex;
        align-items: center;
        padding-left: 5%;
        white-space: nowrap;
    }
    #waterDetial>div>span>img {
        height: 50%;
        filter: grayscale(100%);
    }
    .footerBtn {
        position: relative;
    }
    .footerBtn>div {
        width: 102%;
        height: 114%;
        position: absolute;
        top: 0;
        left: 0;
        margin-left: -1%;
        margin-top: -1%;
        border: 1px solid #d4d4d4;
        border-radius: 2vw;
    }*/
</style>
</head>
<body>
<input type="hidden" class="hiddenValue" value="2" name="">
<section class="btnList">
    <ul>
        <li>
            <a class="i1" href=""></a>冲洗
        </li>
        <li>
            <a class="i2" href="{{:U('/Home/Filters/filterDetails')}}"></a>滤芯
        </li>
        <li>
            <a class="i3" href="{{:U('Home/Shop/index')}}"></a>商城
        </li>
        <li>
            <a class="i4" href="{{:U('Home/Users/mine')}}"></a>我的
        </li>
    </ul>
</section>
<section class="canvasBox">
    <section class="ring-inside"></section>
    <canvas id="canvas"></canvas>
    
    <section class="wash" style="display: none;"><img src="__PUBLIC__/Home/images/wash.png"></section><!--冲洗-->
    <section class="service avatar" style="display: none;">
        <img src="__PUBLIC__/Home/images/service.png" alt="">
    </section><!--检修-->
    <section class="addwater" style="display: none;"></section><!-- 制水 -->
    <section class="ring-out" style="display: none;"></section><!--外环-->
    <img class="dripping dripping1" style="display: none;" src="__PUBLIC__/Home/images/dripping.png">
    <img class="dripping dripping2" style="display: none;" src="__PUBLIC__/Home/images/dripping.png">

    <section class="status_text">水满</section>
    <section class="date_show">
        <section></section>
        <section></section>
    </section>
    <div id="waterDetial" >
        <div>
            <span>
                <img src="__PUBLIC__/Home//images/4_47.png" alt="">
                &nbsp;纯水&nbsp; <span>***ppm</span>
            </span>
            <span>
                <img src="__PUBLIC__/Home//images/4_43.png" alt="">
                &nbsp;原水&nbsp;<span>***ppm</span>
            </span>
        </div>
        <div>
            <span>
                剩余流量：&nbsp;<span>***L</span>
            </span>
            <span>
                已用流量：&nbsp;<span>***L</span>
            </span>
        </div>
    </div>
</section> 
<footer class="footerBtn">开机
    <div></div>
</footer>
<script>
const c = document.getElementById('canvas');
const g = c.getContext('2d');
const omega = 200;//值越大，波浪速度越慢
var widthC=$(window).width()*.6;
c.width=widthC;
c.height=widthC;
function addCanvas(color1,color2,waterYield){
    class Point {
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }
        fromPolar(radius, angle) {
            this.x = radius * Math.cos(angle);
            this.y = radius * Math.sin(angle);
            return this;
        }
        add(p) {
            this.x += p.x;
            this.y += p.y;
            return this;
        }
    }
    const center = new Point(canvas.width / 2, canvas.height / 2);
    const arc = (r, theta) => {
        r -= 1;
        g.arc(center.x, center.y, r, 0 - theta, Math.PI + theta);

        return {
            end: new Point().fromPolar(r, -theta).add(center),
            start: new Point().fromPolar(r, Math.PI + theta).add(center)
        };
    }
    const update = () => {
        //外圆环
        c.width = c.width;
        g.lineCap='round';
        g.lineWidth = 0;
        g.beginPath();
        var gradient=g.createLinearGradient(0,0,0,c.width);
        // gradient.addColorStop("0","#7112fb");
        // gradient.addColorStop("1","#1dd4fe");
        g.strokeStyle = gradient;
        g.arc(c.width*0.5, c.width*0.5, c.width, -37*Math.PI/180, 217* Math.PI/180,false);
        g.stroke();
        //第一波浪
        g.fillStyle =color1;
        g.beginPath();
        let sides = arc(c.width*0.5, waterYield);
        let dx = sides.end.x - sides.start.x;
        let xo = 0;
        for (var x = sides.start.x; x < sides.end.x; xo++, x++) {
            const envelope = xo / dx * (1 - (xo / dx)) * 1;
            g.lineTo(x, sides.start.y + 65 * envelope * Math.cos(Date.now() / omega + xo / dx * 3));//波浪高度
        }
        g.fill();
        //第二波浪
        g.fillStyle = color2;
        g.beginPath();
        sides = arc(c.width*0.5, waterYield);
        dx = sides.end.x - sides.start.x;
        xo = 0;
        for (var x = sides.start.x; x < sides.end.x; xo++, x++) {
            const envelope = xo / dx * (1 - (xo / dx)) * 1;
            g.lineTo(x, sides.start.y + 65 * envelope * Math.sin(Date.now() / omega + xo / dx * 3));//波浪高度
        }
        g.fill();
        requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
}
//判断水机状态
if($(".hiddenValue").val()==1){//制水
    addCanvas("#37BBD4","#87E8FD",-0.83);
    $(".status_text").html("制水");
    $(".addwater").show();
    $(".dripping").show();

}else if($(".hiddenValue").val()==2){//冲洗
    addCanvas("#37BBD4","#87E8FD",-0.83);
    $(".status_text").html("冲洗");
    $(".wash").show();
    $(".ring-out").show();
}else if($(".hiddenValue").val()==3){//缺水
    addCanvas("#D34656","#FD8795",-0.83);
    $(".status_text").html("缺水");
    $(".ring-out").show();
}else if($(".hiddenValue").val()==4){//水满
    addCanvas("#37BBD4","#87E8FD",0.65);
    $(".status_text").html("水满");
    $(".ring-out").show();
}else if($(".hiddenValue").val()==5){//检修
    addCanvas("#37BBD4","#87E8FD",0.65);
    $(".status_text").html("检修");
    $(".service").show();
    $(".ring-out").show();
}else if($(".hiddenValue").val()==6){ //关机
    $("#canvas").hide();
    $(".status_text").html("");
    $(".ring-inside").hide();
    $("#waterDetial").css({display:'block'});
    $(".canvasBox").css({filter:'grayscale(100%)'});
    $(".btnList").css({filter:'grayscale(100%)'});
}
</script>

</body>
</html>
