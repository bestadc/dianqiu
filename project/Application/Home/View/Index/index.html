<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1" >
<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/mobileStyle.css">
<title>点球共享水</title>
</head>
<body>
<input type="hidden" class="hiddenValue" value="1" name="">
<section class="btnList">
    <ul>
        <li>
            <a class="i1" href=""></a>冲洗
        </li>
        <li>
            <a class="i2" href="{{:U('/Home/Filters/filterDetails')}}"></a>滤芯
        </li>
        <li>
            <a class="i3" href="{{:U('Home/Shop/index')}}"></a>商城
        </li>
        <li>
            <a class="i4" href="{{:U('Home/Users/mine')}}"></a>我的
        </li>
    </ul>
</section>
<section class="canvasBox">
    <section class="ring-inside"></section>
    <canvas id="canvas"></canvas>
    
    <section class="wash" style="display: none;"><img src="__PUBLIC__/Home/images/wash.png"></section><!--冲洗-->
    <section class="service avatar" style="display: none;">
        <img src="__PUBLIC__/Home/images/service.png" alt="">
    </section><!--检修-->
    <section class="addwater" style="display: none;"></section><!-- 制水 -->
    <section class="ring-out" style="display: none;"></section><!--外环-->
    <img class="dripping dripping1" style="display: none;" src="__PUBLIC__/Home/images/dripping.png">
    <img class="dripping dripping2" style="display: none;" src="__PUBLIC__/Home/images/dripping.png">
    <div class="status_text_father">
        <section class="status_text">水满</section>
    </div>
    <section class="date_show">
        <section></section>
        <section></section>
    </section>
    <div id="waterDetial" >
        <div>
            <span>
                <img src="__PUBLIC__/Home//images/4_47.png" alt="">
                &nbsp;纯水&nbsp; <span>{{$deviceInfo['rawtds']}}ppm</span>
            </span>
            <span>
                <img src="__PUBLIC__/Home//images/4_43.png" alt="">
                &nbsp;原水&nbsp;<span>{{$deviceInfo['puretds']}}ppm</span>
            </span>
        </div>
        <div>
            <span>
                剩余流量：&nbsp;<span>{{$deviceInfo['reflow']}}L</span>
            </span>
            <span>
                已用流量：&nbsp;<span>{{$deviceInfo['sumflow']}}L</span>
            </span>
        </div>
    </div>
</section> 
<footer id="footer">
    <div class="footerBtn">
        开关
        <div></div>
    </div>
</footer>
<script>
const c = document.getElementById('canvas');
const g = c.getContext('2d');
const omega = 200;//值越大，波浪速度越慢
var widthC=$(window).width()*.6;
c.width=widthC;
c.height=widthC;
function addCanvas(color1,color2,waterYield){
    class Point {
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }
        fromPolar(radius, angle) {
            this.x = radius * Math.cos(angle);
            this.y = radius * Math.sin(angle);
            return this;
        }
        add(p) {
            this.x += p.x;
            this.y += p.y;
            return this;
        }
    }
    const center = new Point(canvas.width / 2, canvas.height / 2);
    const arc = (r, theta) => {
        r -= 1;
        g.arc(center.x, center.y, r, 0 - theta, Math.PI + theta);

        return {
            end: new Point().fromPolar(r, -theta).add(center),
            start: new Point().fromPolar(r, Math.PI + theta).add(center)
        };
    }
    const update = () => {
        //外圆环
        c.width = c.width;
        g.lineCap='round';
        g.lineWidth = 0;
        g.beginPath();
        var gradient=g.createLinearGradient(0,0,0,c.width);
        // gradient.addColorStop("0","#7112fb");
        // gradient.addColorStop("1","#1dd4fe");
        g.strokeStyle = gradient;
        g.arc(c.width*0.5, c.width*0.5, c.width, -37*Math.PI/180, 217* Math.PI/180,false);
        g.stroke();
        //第一波浪
        g.fillStyle =color1;
        g.beginPath();
        let sides = arc(c.width*0.5, waterYield);
        let dx = sides.end.x - sides.start.x;
        let xo = 0;
        for (var x = sides.start.x; x < sides.end.x; xo++, x++) {
            const envelope = xo / dx * (1 - (xo / dx)) * 1;
            g.lineTo(x, sides.start.y + 65 * envelope * Math.cos(Date.now() / omega + xo / dx * 3));//波浪高度
        }
        g.fill();
        //第二波浪
        g.fillStyle = color2;
        g.beginPath();
        sides = arc(c.width*0.5, waterYield);
        dx = sides.end.x - sides.start.x;
        xo = 0;
        for (var x = sides.start.x; x < sides.end.x; xo++, x++) {
            const envelope = xo / dx * (1 - (xo / dx)) * 1;
            g.lineTo(x, sides.start.y + 65 * envelope * Math.sin(Date.now() / omega + xo / dx * 3));//波浪高度
        }
        g.fill();
        requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
}

machineStatus();
function machineStatus(){
    //判断水机状态
    if($(".hiddenValue").val()==1){//制水
        addCanvas("#37BBD4","#87E8FD",-0.83);
        $(".status_text").html("制水");
        $(".addwater").show();
        $(".dripping").show();

    }else if($(".hiddenValue").val()==2){//冲洗
        addCanvas("#37BBD4","#87E8FD",-0.83);
        $(".status_text").html("冲洗");
        $(".wash").show();
        $(".ring-out").show();
    }else if($(".hiddenValue").val()==3){//缺水
        addCanvas("#D34656","#FD8795",-0.83);
        $(".status_text").html("缺水");
        $(".ring-out").show();
    }else if($(".hiddenValue").val()==4){//水满
        addCanvas("#37BBD4","#87E8FD",0.65);
        $(".status_text").html("水满");
        $(".ring-out").show();
    }else if($(".hiddenValue").val()==5){//检修
        addCanvas("#37BBD4","#87E8FD",0.65);
        $(".status_text").html("检修");
        $(".service").show();
        $(".ring-out").show();
    }else if($(".hiddenValue").val()==7){ //关机
        $(".status_text").html("");
        $(".ring-inside").hide();
        $(".canvasBox").css({filter:'grayscale(100%)'});
        $(".btnList").css({filter:'grayscale(100%)'});
    }
}
// 点击‘开关’按钮，状态切换
let isON = 'yes';

$(".footerBtn").on('click',function(){

    isON = isON == 'yes' ? 'no' : 'yes';

    isON == 'yes' 
            ? (
                $(".hiddenValue").val(2),
                $("#canvas").css({display: 'block'}),
                $(".canvasBox").css({filter:'grayscale(0%)'}),
                $(".btnList").css({filter:'grayscale(0%)'})
            )
            : (
                $(".hiddenValue").val(7), 
                $("#canvas").css({display: 'none'}),
                $(".wash").css({display: 'none'}),
                $(".ring-out").css({display: 'none'}),
                $(".addwater").css({display: 'none'}),
                $(".dripping").css({display: 'none'}),
                $(".avatar").css({display: 'none'})
            );

    machineStatus();
    // console.log(isON, $(".hiddenValue").val());
});

</script>

</body>
</html>
